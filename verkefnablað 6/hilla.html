<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="utf-8" />
    <title>KALLAX – Blinn-Phong lýsing</title>
    
    <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec4 vPosition;
    attribute vec3 vNormal;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat3 normalMatrix;
    uniform vec4 lightPosition;

    varying vec3 N, L, E;

    void main()
    {
        vec3 pos = (modelViewMatrix * vPosition).xyz;

        if (lightPosition.w == 0.0)
            L = normalize(lightPosition.xyz);
        else
            L = normalize(lightPosition.xyz - pos);

        E = -normalize(pos);
        N = normalize(normalMatrix * vNormal);

        gl_Position = projectionMatrix * modelViewMatrix * vPosition;
    }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;

    uniform vec4 ambientProduct;
    uniform vec4 diffuseProduct;
    uniform vec4 specularProduct;
    uniform float shininess;

    varying vec3 N, L, E;

    void main()
    {
        vec3 H = normalize(L + E);

        vec4 ambient = ambientProduct;
        float Kd = max(dot(N, L), 0.0);
        vec4 diffuse = Kd * diffuseProduct;

        float Ks = pow(max(dot(N, H), 0.0), shininess);
        vec4 specular = Ks * specularProduct;

        if(dot(N, L) < 0.0) specular = vec4(0.0);

        gl_FragColor = ambient + diffuse + specular;
        gl_FragColor.a = 1.0;
    }
    </script>

    <script type="text/javascript" src="../Common/webgl-utils.js"></script>
    <script type="text/javascript" src="../Common/initShaders.js"></script>
    <script type="text/javascript" src="../Common/MV.js"></script>
    <script type="text/javascript" src="hilla.js"></script>
</head>

<body>
    <h2 style="font-family: sans-serif;"> Blinn-Phong lýsing (Phong litun)</h2>
    <canvas id="gl-canvas" width="600" height="600"></canvas>
</body>
</html>
